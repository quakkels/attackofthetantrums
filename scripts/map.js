var Map = function (vpWidth, vpHeight, mapEndFunc, stopEnemySpawnFunc) {

	this.mapEnded = mapEndFunc;
	this.stopSpawningEnemies = stopEnemySpawnFunc;
	this.viewPort = {
		width: vpWidth,
		height: vpHeight
	};

	this.chair = new Image();
	this.chair.src='chair.png';
	
	this.computer = new Image();
	this.computer.src = 'computer.png';

	this.tileSize = 32;
	this.tiles = [
		[ 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0 ],
		[ 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0 ],
		[ 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0 ],
		[ 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0 ],
		[ 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0 ],
		[ 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0 ],
		[ 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0 ],
		[ 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0 ],
		[ 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0 ],
		[ 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0 ],
		[ 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0 ],
		[ 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0 ],
		[ 0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0 ],
		[ 0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0 ],
		[ 0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0 ],
		[ 1,1,0,0,0,0,1,0,0,1,0,0,1,0,0,1,0 ],
		[ 0,0,0,0,1,0,0,0,0,0,1,0,1,0,1,0,0 ],
		[ 0,0,1,0,0,0,0,0,0,0,0,0,2,0,0,0,0 ],
		[ 0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0 ],
		[ 0,1,0,0,0,0,1,0,0,2,0,0,1,0,2,0,0 ],
		[ 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0 ],
		[ 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0 ],
		[ 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0 ],
		[ 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0 ],
		[ 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0 ],
		[ 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0 ],
		[ 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0 ],
		[ 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0 ],
		[ 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0 ],
		[ 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0 ],
		[ 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0 ],
		[ 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0 ],
		[ 0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0 ],
		[ 0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0 ],
		[ 0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0 ],
		[ 0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0 ],
		[ 0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0 ],
		[ 0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0 ],
		[ 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0 ],
		[ 0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0 ],
		[ 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0 ],
		[ 0,0,0,0,0,0,0,1,0,0,0,0,1,1,0,0,0 ],
		[ 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0 ],
		[ 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0 ],
		[ 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0 ],
		[ 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0 ],
		[ 0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0 ],
		[ 0,0,0,1,0,0,0,0,0,0,0,0,1,0,0,0,0 ],
		[ 0,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0 ],
		[ 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0 ],
		[ 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0 ],
		[ 0,0,0,2,0,0,0,0,0,0,0,0,0,0,0,0,0 ],
		[ 0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0 ],
		[ 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0 ],
		[ 0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0 ],
		[ 0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0 ],
		[ 0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0 ],
		[ 0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0 ],
		[ 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1 ],
		[ 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0 ],
		[ 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0 ],
		[ 0,0,1,0,0,0,0,0,2,0,0,0,0,0,0,0,0 ],
		[ 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0 ],
		[ 0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0 ],
		[ 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0 ],
		[ 0,0,0,0,0,0,0,0,0,0,0,0,1,1,0,0,0 ],
		[ 0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0 ],
		[ 0,0,0,1,0,0,0,0,0,0,0,0,1,0,0,0,0 ],
		[ 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0 ],
		[ 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0 ],
		[ 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0 ],
		[ 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0 ],
		[ 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0 ],
		[ 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0 ],
		[ 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0 ],
		[ 0,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0 ],
		[ 0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,2,0 ],
		[ 0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0 ],
		[ 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1 ],
		[ 0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0 ],
		[ 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0 ],
		[ 0,0,0,0,0,0,0,0,0,0,0,0,1,1,0,0,0 ],
		[ 0,0,0,0,0,0,0,0,0,0,0,0,2,1,0,0,0 ],
		[ 0,0,0,1,0,0,0,0,0,0,0,0,1,0,0,0,0 ],
		[ 0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0 ],
		[ 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0 ],
		[ 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0 ],
		[ 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0 ],
		[ 0,0,0,2,0,0,0,0,0,0,0,0,0,0,0,0,0 ],
		[ 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0 ],
		[ 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0 ],
		[ 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0 ],
		[ 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0 ],
		[ 0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0 ],
		[ 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0 ],
		[ 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0 ],
		[ 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0 ],
		[ 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0 ],
		[ 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0 ],
		[ 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0 ],
		[ 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0 ],
		[ 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0 ],
		[ 0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0 ],
		[ 0,0,0,0,0,0,0,0,1,0,0,0,2,0,0,0,0 ],
		[ 0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0 ],
		[ 0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0 ],
		[ 0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0 ],
		[ 0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0 ],
		[ 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0 ],
		[ 0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0 ],
		[ 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0 ],
		[ 0,0,0,0,0,0,0,1,0,0,0,0,1,1,0,0,0 ],
		[ 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0 ],
		[ 0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,0 ],
		[ 0,0,0,0,2,0,0,0,0,0,0,0,0,0,0,0,0 ],
		[ 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0 ],
		[ 0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0 ],
		[ 0,0,0,1,0,0,0,0,0,0,0,0,1,0,0,0,0 ],
		[ 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0 ],
		[ 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0 ],
		[ 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0 ],
		[ 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0 ],
		[ 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0 ],
		[ 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0 ],
		[ 0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0 ],
		[ 0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0 ],
		[ 0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0 ],
		[ 0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0 ],
		[ 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1 ],
		[ 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0 ],
		[ 0,0,0,0,0,0,2,0,0,0,0,0,0,0,0,0,0 ],
		[ 0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0 ],
		[ 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0 ],
		[ 0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0 ],
		[ 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0 ],
		[ 0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0 ],
		[ 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0 ],
		[ 0,0,0,1,0,0,0,0,0,0,0,0,1,0,0,0,0 ],
		[ 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0 ],
		[ 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0 ],
		[ 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0 ],
		[ 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0 ],
		[ 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0 ],
		[ 0,0,0,0,0,0,0,0,0,0,0,0,0,2,0,0,0 ],
		[ 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0 ],
		[ 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0 ],
		[ 0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0 ],
		[ 0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0 ],
		[ 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1 ],
		[ 0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0 ],
		[ 0,0,0,0,0,0,2,0,0,0,0,0,0,0,0,0,0 ],
		[ 0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0 ],
		[ 0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0 ],
		[ 0,0,0,1,0,0,0,0,0,0,0,0,1,0,0,0,0 ],
		[ 0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0 ],
		[ 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0 ],
		[ 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0 ],
		[ 0,0,0,2,0,0,0,0,0,0,0,0,0,0,0,0,0 ],
		[ 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0 ],
		[ 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0 ],
		[ 0,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0 ],
		[ 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0 ],
		[ 0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0 ],
		[ 0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0 ],
		[ 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1 ],
		[ 0,0,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0 ],
		[ 0,1,0,0,1,0,1,0,1,0,0,1,0,0,0,0,1 ],
		[ 1,0,0,0,0,0,0,1,0,0,0,0,0,0,0,1,0 ],
		[ 0,0,0,0,2,0,0,0,0,0,0,0,1,0,0,0,0 ],
		[ 0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,0 ],
		[ 1,0,0,0,0,0,0,1,0,0,0,1,0,0,0,1,0 ],
		[ 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0 ],
		[ 0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0 ],
		[ 0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,0,0 ],
		[ 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0 ],
		[ 0,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0 ],
		[ 0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0 ],
		[ 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0 ],
		[ 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0 ],
		[ 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0 ],
		[ 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0 ],
		[ 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0 ],
		[ 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0 ],
		[ 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0 ],
		[ 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0 ],
		[ 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0 ],
		[ 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0 ],
		[ 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0 ],
		[ 0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,0,0 ],
		[ 0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0 ],
		[ 0,2,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0 ],
		[ 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0 ]
	];
	this.x = this.tileSize * this.tiles.length - this.viewPort.height;
};

Map.prototype.update = function() {
	this.x -=1;

	if (this.x < 0) { this.x = 0; }
	if (this.x < 20*this.tileSize) { this.stopSpawningEnemies(); }
	if (this.x <= 0) { 
		this.mapEnded([
			"YOU HAVE WON!!!", 
			"You scored " + Game.score + " points."
		]); 
	}
};

Map.prototype.draw = function(context) {
	// find starting row
	var row = 0;
	var remainder = this.x % this.tileSize;
	if (remainder != 0) {
		row = (this.x - remainder) / this.tileSize - 1;
	} else {
		row = this.x / this.tileSize - 1;
	}
	if (row < 0) { row = 0; }

	var endRow = (this.viewPort.height / this.tileSize) + row + 2;
	if (endRow >= this.tiles.length) { endRow = this.tiles.length; }

	var xPosition = 0;
	// var wholeMapHeight = (this.tiles.length * this.tileSize);
	// var (wholeMapHeight - this.x)

	for (; row < endRow; row++) {
		for (var column = 0; column < this.tiles[0].length; column++ ) {
			
				context.fillStyle = '#90A0A3';

			
			context.fillRect(
				column * this.tileSize, 
				xPosition - remainder, 
				this.tileSize, 
				this.tileSize);

			if (this.tiles[row][column] === 1) {
				context.drawImage(
					this.chair, 
					column * this.tileSize, 
					xPosition - remainder, 
					this.tileSize, 
					this.tileSize);
			}

			if (this.tiles[row][column] === 2) {
				context.drawImage(
					this.computer, 
					column * this.tileSize, 
					xPosition - remainder, 
					this.tileSize, 
					this.tileSize);
			}
		}
		xPosition += this.tileSize;
	}	
};